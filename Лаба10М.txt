import telebot
from telebot import types
import sqlite3
import random
import csv
bot = telebot.TeleBot('6885012444:AAE5cSz8P5u6v6nijTr75eq6pQ2f9mmbncQ')
@bot.message_handler(content_types=['text'])
def start(message):
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True)
    btn1 = types.KeyboardButton("üëã –ü–æ–∑–¥–æ—Ä–æ–≤–∞—Ç—å—Å—è")
    btn2 = types.KeyboardButton("Start")
    markup.add(btn1, btn2)
    bot.send_message(message.chat.id, text="–ü—Ä–∏–≤–µ—Ç, {0.first_name}! –Ø —Ç–µ—Å—Ç–æ–≤—ã–π –±–æ—Ç –¥–ª—è –ê–ª–µ–º–∞—Å–æ–≤–∞".format(message.from_user), reply_markup=markup)
    bot.register_next_step_handler(message, func)
@bot.message_handler(content_types=['text'])
def func(message):
    if (message.text == "üëã –ü–æ–∑–¥–æ—Ä–æ–≤–∞—Ç—å—Å—è"):
        bot.send_message(message.chat.id, text="–ü—Ä–∏–≤–µ–µ—Ç.. –£–¥–∞—á–Ω–æ–≥–æ –¥–Ω—è!!!)")
        markup = types.ReplyKeyboardMarkup(resize_keyboard=True)
        btn1 = types.KeyboardButton('/Start')
        markup.add(btn1)
        bot.send_message(message.chat.id, text="–î–∞–≤–∞–π –Ω–∞—á–Ω—ë–º", reply_markup=markup)
        bot.register_next_step_handler(message, start1);
    else:
        bot.register_next_step_handler(message, start1);
@bot.message_handler(content_types=['text'])
def start1(message):
    bot.send_message(message.chat.id, "–í–≤–µ–¥–∏—Ç–µ —Å–ª–µ–¥—É—é—â—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é:")
    bot.send_message(message.chat.id, "–§–∞–º–∏–ª–∏—è:")
    bot.register_next_step_handler(message, get_lastname)

def get_lastname(message):
    lastname = message.text
    bot.send_message(message.chat.id, "–ò–º—è:")
    bot.register_next_step_handler(message, get_firstname, lastname)

def get_firstname(message, lastname):
    firstname = message.text
    bot.send_message(message.chat.id, "–û—Ç—á–µ—Å—Ç–≤–æ:")
    bot.register_next_step_handler(message, get_middlename, lastname, firstname)

def get_middlename(message, lastname, firstname):
    middlename = message.text
    bot.send_message(message.chat.id, "–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è (–≤ —Ñ–æ—Ä–º–∞—Ç–µ –ì–ì–ì–ì-–ú–ú-–î–î):")
    bot.register_next_step_handler(message, save_data, lastname, firstname, middlename)

def save_data(message, lastname, firstname, middlename):
    birthday = message.text
    userid = message.chat.id
    username = message.chat.first_name

    con = sqlite3.connect('–±–¥.db')
    cur = con.cursor()
    cur.execute(
        '''CREATE TABLE IF NOT EXISTS botsave
        (id INTEGER PRIMARY KEY AUTOINCREMENT,
        userid integer,
        username TEXT,
        f TEXT,
        i TEXT,
        o TEXT,
        birthday TEXT)'''
    )
    cur.execute('''INSERT INTO botsave (userid, username, f, i, o, birthday) VALUES (?, ?, ?, ?, ?, ?)''',
                (userid, username, lastname, firstname, middlename, birthday))

    cur.execute('''SELECT * FROM botsave''')
    with open('savecsv.csv', 'w', newline='', encoding='utf-8') as csvfile:
        csv_writter = csv.writer(csvfile)
        csv_writter.writerow(['id', 'userid', 'username', 'f', 'i', 'o', 'birthday'])
        csv_writter.writerows(cur)

    con.commit()
    con.close()

    bot.reply_to(message, "–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ")

if __name__ == '__main__':
    bot.polling()
